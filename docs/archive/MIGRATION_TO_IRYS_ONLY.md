# PostgreSQL ‚Üí Irys-Only ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Í≥ÑÌöç

**Î™©Ìëú:** ÏôÑÏ†ÑÌïú ÏÑúÎ≤ÑÎ¶¨Ïä§, ÌÉàÏ§ëÏïôÌôî BaaSÎ°ú Ï†ÑÌôò
**Í∏∞Í∞Ñ:** 4Ï£º
**Ïä¨Î°úÍ±¥:** "Kill the Server, Keep the Data"

---

## üìã ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏

### ‚úÖ Phase 1: Irys ÏΩîÏñ¥ Íµ¨ÌòÑ (1Ï£º)

- [ ] `IrysDatabase` ÌÅ¥ÎûòÏä§ ÏôÑÏÑ±
- [ ] CRUD ÏûëÏóÖ Íµ¨ÌòÑ
- [ ] ÌÉúÍ∑∏ Ï†ÑÎûµ ÌôïÏ†ï
- [ ] ÏóîÌã∞Ìã∞ Ïä§ÌÇ§Îßà Ï†ïÏùò
- [ ] ÌÖåÏä§Ìä∏ ÏûëÏÑ±

### ‚úÖ Phase 2: Ï∫êÏã± ÏãúÏä§ÌÖú (1Ï£º)

- [ ] IndexedDB ÌÜµÌï©
- [ ] Ï∫êÏãú Ï†ÑÎûµ Íµ¨ÌòÑ
- [ ] Prefetching Î°úÏßÅ
- [ ] ÎÇôÍ¥ÄÏ†Å UI ÏóÖÎç∞Ïù¥Ìä∏
- [ ] Ïò§ÌîÑÎùºÏù∏ Î™®Îìú

### ‚úÖ Phase 3: Frontend Ï†ÑÌôò (1Ï£º)

- [ ] PostgreSQL ÏøºÎ¶¨ ‚Üí Irys ÏøºÎ¶¨Î°ú Ï†ÑÌôò
- [ ] GraphQL resolvers Ï†úÍ±∞
- [ ] API calls ‚Üí ÏßÅÏ†ë Irys calls
- [ ] Ïä§ÏºàÎ†àÌÜ§ UI Ï∂îÍ∞Ä
- [ ] Progressive loading

### ‚úÖ Phase 4: Ï†ïÎ¶¨ Î∞è Î∞∞Ìè¨ (1Ï£º)

- [ ] PostgreSQL ÏùòÏ°¥ÏÑ± Ï†úÍ±∞
- [ ] API ÏÑúÎ≤Ñ Ï†úÍ±∞
- [ ] Prisma Ï†úÍ±∞
- [ ] ÏàúÏàò Ï†ïÏ†Å ÏÇ¨Ïù¥Ìä∏Î°ú Î∞∞Ìè¨
- [ ] Î¨∏ÏÑú ÏóÖÎç∞Ïù¥Ìä∏

---

## üóëÔ∏è Ï†úÍ±∞Ìï† Í≤ÉÎì§

### Backend ÏôÑÏ†Ñ Ï†úÍ±∞:

```bash
# Ï†úÍ±∞Ìï† ÎîîÎ†âÌÜ†Î¶¨
rm -rf apps/api

# Ï†úÍ±∞Ìï† ÌååÏùº
apps/api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index-enhanced.ts          ‚ùå Ï†úÍ±∞
‚îÇ   ‚îú‚îÄ‚îÄ resolvers/                 ‚ùå Ï†úÍ±∞
‚îÇ   ‚îú‚îÄ‚îÄ services/                  ‚ùå Ï†úÍ±∞
‚îÇ   ‚îî‚îÄ‚îÄ schema-enhanced.graphql    ‚ùå Ï†úÍ±∞
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma              ‚ùå Ï†úÍ±∞
‚îî‚îÄ‚îÄ package.json                   ‚ùå Ï†úÍ±∞
```

### FrontendÏóêÏÑú Ï†úÍ±∞:

```typescript
// ‚ùå Ï†úÍ±∞Ìï† Í≤ÉÎì§
import { ApolloClient } from '@apollo/client';      ‚ùå
import { GraphQLClient } from 'graphql-request';   ‚ùå
import { PrismaClient } from '@prisma/client';     ‚ùå

// ‚ùå Ï†úÍ±∞Ìï† ÌååÏùº
apps/web-vite/src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ apollo.ts              ‚ùå Apollo Ï†úÍ±∞
‚îÇ   ‚îú‚îÄ‚îÄ graphql/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ queries.ts         ‚ùå GraphQL ÏøºÎ¶¨ Ï†úÍ±∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mutations.ts       ‚ùå GraphQL ÎÆ§ÌÖåÏù¥ÏÖò Ï†úÍ±∞
‚îÇ   ‚îî‚îÄ‚îÄ api.ts                 ‚ùå API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï†úÍ±∞
```

---

## ‚úÖ Ï∂îÍ∞ÄÌï† Í≤ÉÎì§

### ÏÉàÎ°úÏö¥ Irys ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏:

```bash
# ÏÉàÎ°ú ÏÉùÏÑ±Ìï† ÌååÏùº
apps/web-vite/src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ irys-database.ts       ‚úÖ ÌïµÏã¨ DB ÌÅ¥ÎûòÏä§
‚îÇ   ‚îú‚îÄ‚îÄ irys-cache.ts          ‚úÖ IndexedDB Ï∫êÏã±
‚îÇ   ‚îú‚îÄ‚îÄ irys-hooks.ts          ‚úÖ React hooks
‚îÇ   ‚îî‚îÄ‚îÄ irys-types.ts          ‚úÖ ÌÉÄÏûÖ Ï†ïÏùò
```

---

## üîÑ ÏΩîÎìú Ï†ÑÌôò ÏòàÏãú

### Before (PostgreSQL + GraphQL):

```typescript
// ‚ùå Í∏∞Ï°¥ ÏΩîÎìú
import { useQuery, useMutation } from '@apollo/client';
import { GET_PROJECTS, CREATE_PROJECT } from '@/lib/graphql/queries';

function ProjectsPage() {
  // GraphQL ÏøºÎ¶¨
  const { data, loading } = useQuery(GET_PROJECTS, {
    variables: { userId: user.id }
  });

  // GraphQL ÎÆ§ÌÖåÏù¥ÏÖò
  const [createProject] = useMutation(CREATE_PROJECT);

  const handleCreate = async () => {
    await createProject({
      variables: {
        input: {
          name: 'New Project',
          slug: 'new-project'
        }
      }
    });
  };

  if (loading) return <div>Loading...</div>;

  return (
    <div>
      {data.projects.map(project => (
        <ProjectCard key={project.id} project={project} />
      ))}
    </div>
  );
}
```

### After (Irys-Only):

```typescript
// ‚úÖ ÏÉà ÏΩîÎìú
import { useIrysQuery, useIrysMutation } from '@/lib/irys-hooks';

function ProjectsPage() {
  // Irys ÏøºÎ¶¨ (IndexedDB Ï∫êÏã± Ìè¨Ìï®)
  const { data, loading } = useIrysQuery('projects', async (db) => {
    return await db.getUserProjects(user.address);
  });

  // Irys ÎÆ§ÌÖåÏù¥ÏÖò
  const createProject = useIrysMutation(async (db, input) => {
    return await db.createProject(input);
  });

  const handleCreate = async () => {
    await createProject({
      name: 'New Project',
      slug: 'new-project',
      owner: user.address
    });
  };

  if (loading) {
    return (
      <div className="space-y-4">
        {[1, 2, 3].map(i => <Skeleton key={i} className="h-24" />)}
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {data.map(project => (
        <ProjectCard key={project.entityId} project={project} />
      ))}
    </div>
  );
}
```

---

## üõ†Ô∏è Íµ¨ÌòÑ ÏÉÅÏÑ∏

### 1. IrysDatabase ÌÅ¥ÎûòÏä§

```typescript
// apps/web-vite/src/lib/irys-database.ts

import { Uploader } from '@irys/upload';
import { Query } from '@irys/query';
import { openDB, IDBPDatabase } from 'idb';

export class IrysDatabase {
  private uploader: Uploader;
  private query: Query;
  private cache: IDBPDatabase;

  constructor() {
    this.uploader = new Uploader({ network: 'mainnet' });
    this.query = new Query({ network: 'mainnet' });
  }

  async init() {
    this.cache = await openDB('IrysBase', 1, {
      upgrade(db) {
        db.createObjectStore('projects', { keyPath: 'entityId' });
        db.createObjectStore('documents', { keyPath: 'entityId' });
        db.createObjectStore('users', { keyPath: 'entityId' });
      }
    });
  }

  // Projects
  async createProject(data: ProjectInput): Promise<Project> { /* ... */ }
  async getProjectBySlug(slug: string): Promise<Project | null> { /* ... */ }
  async getUserProjects(ownerAddress: string): Promise<Project[]> { /* ... */ }
  async updateProject(entityId: string, updates: ProjectUpdate): Promise<Project> { /* ... */ }
  async deleteProject(entityId: string, deletedBy: string): Promise<boolean> { /* ... */ }

  // Documents
  async createDocument(data: DocumentInput): Promise<Document> { /* ... */ }
  async getDocument(entityId: string): Promise<Document | null> { /* ... */ }
  async getProjectDocuments(projectId: string): Promise<Document[]> { /* ... */ }
  async updateDocument(entityId: string, updates: DocumentUpdate): Promise<Document> { /* ... */ }
  async deleteDocument(entityId: string, deletedBy: string): Promise<boolean> { /* ... */ }

  // Search
  async searchDocuments(query: string): Promise<Document[]> { /* ... */ }
  async getDocumentVersions(entityId: string): Promise<DocumentVersion[]> { /* ... */ }
}

// Singleton instance
export const irysDb = new IrysDatabase();
```

### 2. React Hooks

```typescript
// apps/web-vite/src/lib/irys-hooks.ts

import { useState, useEffect } from 'react';
import { irysDb } from './irys-database';

export function useIrysQuery<T>(
  key: string,
  queryFn: (db: IrysDatabase) => Promise<T>,
  options?: { cacheTime?: number }
) {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    let cancelled = false;

    async function fetchData() {
      try {
        setLoading(true);
        const result = await queryFn(irysDb);

        if (!cancelled) {
          setData(result);
          setError(null);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err as Error);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    }

    fetchData();

    return () => {
      cancelled = true;
    };
  }, [key]);

  return { data, loading, error };
}

export function useIrysMutation<TInput, TOutput>(
  mutationFn: (db: IrysDatabase, input: TInput) => Promise<TOutput>
) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  const mutate = async (input: TInput) => {
    try {
      setLoading(true);
      setError(null);
      const result = await mutationFn(irysDb, input);
      return result;
    } catch (err) {
      setError(err as Error);
      throw err;
    } finally {
      setLoading(false);
    }
  };

  return { mutate, loading, error };
}

// ÌäπÌôîÎêú hooks
export function useProjects(ownerAddress: string) {
  return useIrysQuery('user-projects', async (db) => {
    return await db.getUserProjects(ownerAddress);
  });
}

export function useProject(slug: string) {
  return useIrysQuery(`project-${slug}`, async (db) => {
    return await db.getProjectBySlug(slug);
  });
}

export function useDocuments(projectId: string) {
  return useIrysQuery(`project-documents-${projectId}`, async (db) => {
    return await db.getProjectDocuments(projectId);
  });
}
```

### 3. Ï†ÑÏó≠ ÏÉÅÌÉú (ÏÑ†ÌÉùÏ†Å)

```typescript
// apps/web-vite/src/lib/irys-store.ts

import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface IrysStore {
  // Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞
  projects: Map<string, Project>;
  documents: Map<string, Document>;

  // Ïï°ÏÖò
  setProject: (project: Project) => void;
  setDocument: (doc: Document) => void;
  invalidateProject: (entityId: string) => void;
  invalidateDocument: (entityId: string) => void;

  // ÎÇôÍ¥ÄÏ†Å ÏóÖÎç∞Ïù¥Ìä∏
  optimisticProjects: Map<string, Project>;
  addOptimisticProject: (project: Project) => void;
  removeOptimisticProject: (entityId: string) => void;
}

export const useIrysStore = create<IrysStore>()(
  persist(
    (set) => ({
      projects: new Map(),
      documents: new Map(),
      optimisticProjects: new Map(),

      setProject: (project) =>
        set((state) => ({
          projects: new Map(state.projects).set(project.entityId, project)
        })),

      setDocument: (doc) =>
        set((state) => ({
          documents: new Map(state.documents).set(doc.entityId, doc)
        })),

      invalidateProject: (entityId) =>
        set((state) => {
          const newProjects = new Map(state.projects);
          newProjects.delete(entityId);
          return { projects: newProjects };
        }),

      invalidateDocument: (entityId) =>
        set((state) => {
          const newDocuments = new Map(state.documents);
          newDocuments.delete(entityId);
          return { documents: newDocuments };
        }),

      addOptimisticProject: (project) =>
        set((state) => ({
          optimisticProjects: new Map(state.optimisticProjects).set(
            project.entityId,
            project
          )
        })),

      removeOptimisticProject: (entityId) =>
        set((state) => {
          const newOptimistic = new Map(state.optimisticProjects);
          newOptimistic.delete(entityId);
          return { optimisticProjects: newOptimistic };
        })
    }),
    {
      name: 'irys-storage'
    }
  )
);
```

---

## üéØ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Îã®Í≥ÑÎ≥Ñ Í∞ÄÏù¥Îìú

### Step 1: Irys ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÑ§Ïπò

```bash
cd apps/web-vite
pnpm add @irys/query @irys/upload @irys/sdk idb zustand
```

### Step 2: IrysDatabase Íµ¨ÌòÑ

```bash
# ÌååÏùº ÏÉùÏÑ±
touch src/lib/irys-database.ts
touch src/lib/irys-hooks.ts
touch src/lib/irys-types.ts
touch src/lib/irys-cache.ts

# Íµ¨ÌòÑ (ÏúÑÏùò ÏΩîÎìú Ï∞∏Í≥†)
```

### Step 3: Ìïú ÌéòÏù¥ÏßÄÏî© Ï†ÑÌôò

```bash
# Ïòà: Projects ÌéòÏù¥ÏßÄÎ∂ÄÌÑ∞ ÏãúÏûë
# 1. GraphQL ÏøºÎ¶¨ Ï†úÍ±∞
# 2. useIrysQueryÎ°ú ÎåÄÏ≤¥
# 3. ÌÖåÏä§Ìä∏
# 4. Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú
```

### Step 4: API ÏÑúÎ≤Ñ Ï†úÍ±∞

```bash
# Î™®Îì† ÌéòÏù¥ÏßÄ Ï†ÑÌôò ÏôÑÎ£å ÌõÑ
rm -rf apps/api
git commit -m "Remove PostgreSQL/API server - 100% Irys-Only"
```

### Step 5: Î∞∞Ìè¨ Í∞ÑÏÜåÌôî

```bash
# Vercel/NetlifyÏóê Ï†ïÏ†Å ÏÇ¨Ïù¥Ìä∏Î°ú Î∞∞Ìè¨
# ÏÑúÎ≤Ñ Î∂àÌïÑÏöî!

vercel --prod
# ÎòêÎäî
netlify deploy --prod
```

---

## üìä Before/After ÎπÑÍµê

### Before (ÌïòÏù¥Î∏åÎ¶¨Îìú):

```
Ïù∏ÌîÑÎùº:
- PostgreSQL ÏÑúÎ≤Ñ ($5-25/Ïõî)
- API ÏÑúÎ≤Ñ ($10-50/Ïõî)
- Redis ($5/Ïõî)
- Irys ($0.01/Ïõî)
Ï¥ù: $20-85/Ïõî

ÏΩîÎìúÎ≤†Ïù¥Ïä§:
- apps/api/ (Î∞±ÏóîÎìú)
- apps/web-vite/ (ÌîÑÎ°†Ìä∏ÏóîÎìú)
- Ï¥ù ÎùºÏù∏: ~15,000 LOC

Î∞∞Ìè¨:
- Railway/Heroku (API)
- Vercel (Frontend)
- 2Í∞ú Î∞∞Ìè¨ ÌîÑÎ°úÏÑ∏Ïä§

ÏùòÏ°¥ÏÑ±:
- Prisma
- Apollo Server
- GraphQL
- PostgreSQL
- Redis
```

### After (Irys-Only):

```
Ïù∏ÌîÑÎùº:
- Irys ($0.01/Ïõî)
Ï¥ù: $0.01/Ïõî (99.9% Ï†àÍ∞ê!)

ÏΩîÎìúÎ≤†Ïù¥Ïä§:
- apps/web-vite/ (ÌîÑÎ°†Ìä∏ÏóîÎìúÎßå)
- Ï¥ù ÎùºÏù∏: ~8,000 LOC (47% Í∞êÏÜå)

Î∞∞Ìè¨:
- Vercel/Netlify (Ï†ïÏ†Å ÏÇ¨Ïù¥Ìä∏)
- 1Í∞ú Î∞∞Ìè¨ ÌîÑÎ°úÏÑ∏Ïä§

ÏùòÏ°¥ÏÑ±:
- @irys/query
- @irys/upload
- idb
```

---

## ‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠

### 1. Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò

Í∏∞Ï°¥ PostgreSQL Îç∞Ïù¥ÌÑ∞Î•º IrysÎ°ú Ïù¥Ï†Ñ:

```typescript
// migration script
async function migrateToIrys() {
  const prisma = new PrismaClient();

  // Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞
  const projects = await prisma.project.findMany();

  for (const project of projects) {
    // IrysÏóê ÏóÖÎ°úÎìú
    await irysDb.createProject({
      entityId: project.id,
      name: project.name,
      slug: project.slug,
      owner: project.ownerId,
      // ...
    });

    console.log('Migrated:', project.name);
  }

  console.log('Migration complete!');
}
```

### 2. Ï†êÏßÑÏ†Å Ï†ÑÌôò

```typescript
// ÌïòÏù¥Î∏åÎ¶¨Îìú Í∏∞Í∞Ñ ÎèôÏïà Îëò Îã§ ÏßÄÏõê
async function getProject(slug: string) {
  // Irys Î®ºÏ†Ä ÏãúÎèÑ
  try {
    const irysProject = await irysDb.getProjectBySlug(slug);
    if (irysProject) return irysProject;
  } catch (err) {
    console.warn('Irys failed, falling back to PostgreSQL');
  }

  // Ïã§Ìå® Ïãú PostgreSQL
  return await prisma.project.findUnique({ where: { slug } });
}
```

### 3. Î∞±ÏóÖ

```bash
# PostgreSQL Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
pg_dump $DATABASE_URL > backup.sql

# Irys ÏóÖÎ°úÎìú ÌõÑ Í≤ÄÏ¶ù
# ÏôÑÏ†Ñ Ï†ÑÌôò ÌõÑ PostgreSQL Ï¢ÖÎ£å
```

---

## üöÄ ÏãúÏûëÌïòÍ∏∞

```bash
# 1. Î∏åÎûúÏπò ÏÉùÏÑ±
git checkout -b irys-only-migration

# 2. Irys ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Íµ¨ÌòÑ
# (ÏúÑÏùò ÏΩîÎìú Ï∞∏Í≥†)

# 3. Ìïú ÌéòÏù¥ÏßÄÏî© Ï†ÑÌôò
# Projects ‚Üí Documents ‚Üí Dashboard ‚Üí ...

# 4. ÌÖåÏä§Ìä∏
pnpm test

# 5. API ÏÑúÎ≤Ñ Ï†úÍ±∞
rm -rf apps/api

# 6. Î∞∞Ìè¨
vercel --prod

# 7. ÏäπÎ¶¨! üéâ
```

---

## ‚úÖ ÏôÑÎ£å Í∏∞Ï§Ä

- [ ] PostgreSQL ÏùòÏ°¥ÏÑ± 0Í∞ú
- [ ] API ÏÑúÎ≤Ñ Ï†úÍ±∞
- [ ] Î™®Îì† CRUD ÏûëÏóÖ IrysÎ°ú Ï†ÑÌôò
- [ ] IndexedDB Ï∫êÏã± ÏûëÎèô
- [ ] ÌèâÍ∑† ÏøºÎ¶¨ ÏãúÍ∞Ñ < 300ms
- [ ] Ï∫êÏãú ÌûàÌä∏Ïú® > 80%
- [ ] Ïò§ÌîÑÎùºÏù∏ Î™®Îìú ÏûëÎèô
- [ ] Î∞∞Ìè¨ ÏÑ±Í≥µ (Ï†ïÏ†Å ÏÇ¨Ïù¥Ìä∏)

---

**Ï§ÄÎπÑÎêêÏäµÎãàÎã§. ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå? üöÄ**
